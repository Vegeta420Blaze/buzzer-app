
/*!
 * Non-throwing QR stub.
 * Renders the URL text into the canvas so "Show QR" works without errors.
 * Later you can swap this stub with a full QR library to render a real QR.
 */
(function (window) {
  function makeQR(canvas, text, size) {
    try {
      // Size
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');

      // Background
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Border
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);

      // Title
      ctx.fillStyle = '#000';
      ctx.font = '16px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('Player Link:', 10, 26);

      // Wrap URL text crudely so it fits
      const url = String(text);
      const maxWidth = canvas.width - 20;
      let line = '';
      let y = 50;

      // Split long URL into chunks
      const chunks = [];
      let start = 0;
      const chunkLen = 30; // crude chunk size
      while (start < url.length) {
        chunks.push(url.slice(start, start + chunkLen));
        start += chunkLen;
      }

      for (let i = 0; i < chunks.length; i++) {
        const testLine = line + chunks[i] + ' ';
        if (ctx.measureText(testLine).width > maxWidth) {
          ctx.fillText(line, 10, y);
          line = chunks[i] + ' ';
          y += 22;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, 10, y);

      // Hint
      ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('(Replace qrcode.min.js with a full library to render a real QR)', 10, canvas.height - 12);
    } catch (e) {
      console.error('QR stub failed to render:', e);
    }
  }
  window.__miniQR = { makeQR };
})(window);
